{"version":3,"names":["geovDataFetchExampleCss","qrLabel","id","GeovDataFetchExample","constructor","hostRef","this","buttonClick","e","msg","offsetX","_ssrId","undefined","sparqlEndpoint","entityId","data","setSSRId","componentWillLoad","getSSRData","loading","fetchData","then","d","setSSRData","catch","sparqlJson","res","_a","_b","_c","_d","Object","assign","label","results","bindings","o","value","Date","toTimeString","_","error","render","h","Host","class","onClick"],"sources":["node_modules/@geovistory/design-system-web/dist/collection/components/geov-data-fetch-example/geov-data-fetch-example.css?tag=geov-data-fetch-example","node_modules/@geovistory/design-system-web/dist/collection/components/geov-data-fetch-example/geov-data-fetch-example.js"],"sourcesContent":[":host {\n  display: block;\n}\n","import { h, Host } from \"@stencil/core\";\nimport { sparqlJson } from \"../../lib/sparqlJson\";\nimport { getSSRData } from \"../../lib/ssr/getSSRData\";\nimport { setSSRData } from \"../../lib/ssr/setSSRData\";\nimport { setSSRId } from \"../../lib/ssr/setSSRId\";\nconst qrLabel = (id) => `\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX geov: <http://geovistory.org/resource/>\n\nSELECT ?o\nWHERE {\n  geov:${id} rdfs:label ?o .\n}\nLIMIT 1\n`;\n/**\n * This component is an example for developers who want to ceate a component that\n *\n * - fetches data from a sparql endpoint\n * - is prepared for SSR and hydration\n */\nexport class GeovDataFetchExample {\n  constructor() {\n    this.buttonClick = (e) => {\n      this.msg = 'clicked' + e.offsetX;\n    };\n    this._ssrId = undefined;\n    this.sparqlEndpoint = undefined;\n    this.entityId = undefined;\n    this.data = undefined;\n    this.msg = undefined;\n    // set id for server side rendering of dynamic data\n    setSSRId(this);\n  }\n  /**\n   * called once when component is ready. good for data fetching.\n   * if `componentWillLoad()` returns a promise, stencil hydrate\n   * awaits this promise for server side rendering. See:\n   * https://stenciljs.com/docs/static-site-generation-basics\n   */\n  async componentWillLoad() {\n    // try to get data from ssr\n    this.data = getSSRData(this._ssrId);\n    // if no data found, fetchData\n    if (!this.data) {\n      // set data to loading (in immutable way)\n      this.data = { loading: true };\n      // fetch data via http\n      await this.fetchData() // <- await this promise!\n        .then(d => {\n        this.data = d;\n        setSSRData(this._ssrId, d);\n        return d;\n      })\n        .catch(d => {\n        this.data = d;\n        return d;\n      });\n      this.msg = 'component data was fetched by component';\n    }\n  }\n  /**\n   * Do the sparql request(s)\n   * @returns a Promise with the data for this component\n   */\n  async fetchData() {\n    return sparqlJson(this.sparqlEndpoint, qrLabel(this.entityId))\n      .then(res => {\n      var _a, _b, _c, _d;\n      // process and return the data in case of success\n      return Object.assign(Object.assign({}, this.data), { label: ((_d = (_c = (_b = (_a = res === null || res === void 0 ? void 0 : res.results) === null || _a === void 0 ? void 0 : _a.bindings) === null || _b === void 0 ? void 0 : _b[0]) === null || _c === void 0 ? void 0 : _c.o) === null || _d === void 0 ? void 0 : _d.value) + ' fetched at: ' + new Date().toTimeString(), loading: false });\n    })\n      .catch(_ => {\n      // process and return the data in case of error\n      return Object.assign(Object.assign({}, this.data), { error: true, loading: false });\n    });\n  }\n  render() {\n    return (h(Host, null, h(\"div\", null, this.msg), this.data.label, this.data.loading ? `loading...` : ``, this.data.error ? `error!` : ``, !this.data.label && !this.data.loading && !this.data.error ? h(\"span\", { class: \"no-label-found\" }, \"no label found\") : ``, h(\"button\", { onClick: this.buttonClick }, \"click me!\"), h(\"slot\", null)));\n  }\n  static get is() { return \"geov-data-fetch-example\"; }\n  static get originalStyleUrls() {\n    return {\n      \"$\": [\"geov-data-fetch-example.css\"]\n    };\n  }\n  static get styleUrls() {\n    return {\n      \"$\": [\"geov-data-fetch-example.css\"]\n    };\n  }\n  static get properties() {\n    return {\n      \"_ssrId\": {\n        \"type\": \"string\",\n        \"mutable\": false,\n        \"complexType\": {\n          \"original\": \"string\",\n          \"resolved\": \"string\",\n          \"references\": {}\n        },\n        \"required\": false,\n        \"optional\": true,\n        \"docs\": {\n          \"tags\": [],\n          \"text\": \"_ssrId is short for server side rendering id and\\nidentifies this component and the fetched data\\nrespectively. Set this only if you want to\\nenable this component to fetch serve side\"\n        },\n        \"attribute\": \"_ssr-id\",\n        \"reflect\": true\n      },\n      \"sparqlEndpoint\": {\n        \"type\": \"string\",\n        \"mutable\": false,\n        \"complexType\": {\n          \"original\": \"string\",\n          \"resolved\": \"string\",\n          \"references\": {}\n        },\n        \"required\": false,\n        \"optional\": false,\n        \"docs\": {\n          \"tags\": [],\n          \"text\": \"sparqlEndpoint\\nURL of the sparql endpoint\"\n        },\n        \"attribute\": \"sparql-endpoint\",\n        \"reflect\": false\n      },\n      \"entityId\": {\n        \"type\": \"string\",\n        \"mutable\": false,\n        \"complexType\": {\n          \"original\": \"string\",\n          \"resolved\": \"string\",\n          \"references\": {}\n        },\n        \"required\": false,\n        \"optional\": false,\n        \"docs\": {\n          \"tags\": [],\n          \"text\": \"entityId\\nID number of entity, e.g. 'i315800'\"\n        },\n        \"attribute\": \"entity-id\",\n        \"reflect\": false\n      }\n    };\n  }\n  static get states() {\n    return {\n      \"data\": {},\n      \"msg\": {}\n    };\n  }\n}\n//# sourceMappingURL=geov-data-fetch-example.js.map\n"],"mappings":"mIAAA,MAAMA,EAA0B,uBCKhC,MAAMC,EAAWC,GAAO,wIAMfA,kC,MAUIC,EAAoB,MAC/B,WAAAC,CAAAC,G,UACEC,KAAKC,YAAeC,IAClBF,KAAKG,IAAM,UAAYD,EAAEE,OAAO,EAElCJ,KAAKK,OAASC,UACdN,KAAKO,eAAiBD,UACtBN,KAAKQ,SAAWF,UAChBN,KAAKS,KAAOH,UACZN,KAAKG,IAAMG,UAEXI,EAASV,K,CAQX,uBAAMW,GAEJX,KAAKS,KAAOG,EAAWZ,KAAKK,QAE5B,IAAKL,KAAKS,KAAM,CAEdT,KAAKS,KAAO,CAAEI,QAAS,YAEjBb,KAAKc,YACRC,MAAKC,IACNhB,KAAKS,KAAOO,EACZC,EAAWjB,KAAKK,OAAQW,GACxB,OAAOA,CAAC,IAEPE,OAAMF,IACPhB,KAAKS,KAAOO,EACZ,OAAOA,CAAC,IAEVhB,KAAKG,IAAM,yC,EAOf,eAAMW,GACJ,OAAOK,EAAWnB,KAAKO,eAAgBZ,EAAQK,KAAKQ,WACjDO,MAAKK,IACN,IAAIC,EAAIC,EAAIC,EAAIC,EAEhB,OAAOC,OAAOC,OAAOD,OAAOC,OAAO,GAAI1B,KAAKS,MAAO,CAAEkB,QAASH,GAAMD,GAAMD,GAAMD,EAAKD,IAAQ,MAAQA,SAAa,OAAS,EAAIA,EAAIQ,WAAa,MAAQP,SAAY,OAAS,EAAIA,EAAGQ,YAAc,MAAQP,SAAY,OAAS,EAAIA,EAAG,MAAQ,MAAQC,SAAY,OAAS,EAAIA,EAAGO,KAAO,MAAQN,SAAY,OAAS,EAAIA,EAAGO,OAAS,iBAAkB,IAAIC,MAAOC,eAAgBpB,QAAS,OAAQ,IAEnYK,OAAMgB,GAEAT,OAAOC,OAAOD,OAAOC,OAAO,GAAI1B,KAAKS,MAAO,CAAE0B,MAAO,KAAMtB,QAAS,S,CAG/E,MAAAuB,GACE,OAAQC,EAAEC,EAAM,KAAMD,EAAE,MAAO,KAAMrC,KAAKG,KAAMH,KAAKS,KAAKkB,MAAO3B,KAAKS,KAAKI,QAAU,aAAe,GAAIb,KAAKS,KAAK0B,MAAQ,SAAW,IAAKnC,KAAKS,KAAKkB,QAAU3B,KAAKS,KAAKI,UAAYb,KAAKS,KAAK0B,MAAQE,EAAE,OAAQ,CAAEE,MAAO,kBAAoB,kBAAoB,GAAIF,EAAE,SAAU,CAAEG,QAASxC,KAAKC,aAAe,aAAcoC,EAAE,OAAQ,M"}
import{r as a,e as c,w as n,j as d,h as f,d as g,H as u}from"./p-1bafedb0.js";import{a as p,p as b,g as m}from"./p-00ddae2e.js";import{g as E}from"./p-501d07b5.js";import"./p-a533da20.js";import"./p-b4215fed.js";const y="ion-infinite-scroll{display:none;width:100%}.infinite-scroll-enabled{display:block}",h=class{constructor(s){a(this,s),this.ionInfinite=c(this,"ionInfinite",7),this.thrPx=0,this.thrPc=0,this.didFire=!1,this.isBusy=!1,this.onScroll=()=>{const t=this.scrollEl;if(!t||!this.canStart())return 1;const i=this.el.offsetHeight;if(i===0)return 2;const l=t.scrollTop,r=t.scrollHeight,e=t.offsetHeight,o=this.thrPc!==0?e*this.thrPc:this.thrPx;if((this.position==="bottom"?r-i-l-o-e:l-i-o)<0){if(!this.didFire)return this.isLoading=!0,this.didFire=!0,this.ionInfinite.emit(),3}else this.didFire=!1;return 4},this.isLoading=!1,this.threshold="15%",this.disabled=!1,this.position="bottom"}thresholdChanged(){const s=this.threshold;s.lastIndexOf("%")>-1?(this.thrPx=0,this.thrPc=parseFloat(s)/100):(this.thrPx=parseFloat(s),this.thrPc=0)}disabledChanged(){const s=this.disabled;s&&(this.isLoading=!1,this.isBusy=!1),this.enableScrollEvents(!s)}async connectedCallback(){const s=p(this.el);if(!s){b(this.el);return}this.scrollEl=await m(s),this.thresholdChanged(),this.disabledChanged(),this.position==="top"&&n(()=>{this.scrollEl&&(this.scrollEl.scrollTop=this.scrollEl.scrollHeight-this.scrollEl.clientHeight)})}disconnectedCallback(){this.enableScrollEvents(!1),this.scrollEl=void 0}async complete(){const s=this.scrollEl;if(!(!this.isLoading||!s)&&(this.isLoading=!1,this.position==="top")){this.isBusy=!0;const t=s.scrollHeight-s.scrollTop;requestAnimationFrame(()=>{d(()=>{const l=s.scrollHeight-t;requestAnimationFrame(()=>{n(()=>{s.scrollTop=l,this.isBusy=!1})})})})}}canStart(){return!this.disabled&&!this.isBusy&&!!this.scrollEl&&!this.isLoading}enableScrollEvents(s){this.scrollEl&&(s?this.scrollEl.addEventListener("scroll",this.onScroll):this.scrollEl.removeEventListener("scroll",this.onScroll))}render(){const s=E(this),t=this.disabled;return f(u,{class:{[s]:!0,"infinite-scroll-loading":this.isLoading,"infinite-scroll-enabled":!t}})}get el(){return g(this)}static get watchers(){return{threshold:["thresholdChanged"],disabled:["disabledChanged"]}}};h.style=y;export{h as ion_infinite_scroll};

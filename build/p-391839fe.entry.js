import{r as P,e as p,h as B,d as E}from"./p-1bafedb0.js";import{g as S}from"./p-8e599a9d.js";import{o as c,s as O}from"./p-a533da20.js";import{l as m,t as R,s as q,L as w,a as G,b as j}from"./p-2d560059.js";import{g as C,c as y}from"./p-501d07b5.js";import{a as x}from"./p-b7a6a734.js";/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const V=1,T=2,g=3;class b{constructor(t,i){this.component=t,this.params=i,this.state=V}async init(t){if(this.state=T,!this.element){const i=this.component;this.element=await x(this.delegate,t,i,["ion-page","ion-page-invisible"],this.params)}}_destroy(){c(this.state!==g,"view state must be ATTACHED");const t=this.element;t&&(this.delegate?this.delegate.removeViewFromDom(t.parentElement,t):t.remove()),this.nav=void 0,this.state=g}}const A=(e,t,i)=>!e||e.component!==t?!1:O(e.params,i),k=(e,t)=>e?e instanceof b?e:new b(e,t):null,L=e=>e.map(t=>t instanceof b?t:"component"in t?k(t.component,t.componentProps===null?void 0:t.componentProps):k(t,void 0)).filter(t=>t!==null),N=":host{left:0;right:0;top:0;bottom:0;position:absolute;contain:layout size style;overflow:hidden;z-index:0}",I=class{constructor(e){P(this,e),this.ionNavWillLoad=p(this,"ionNavWillLoad",7),this.ionNavWillChange=p(this,"ionNavWillChange",3),this.ionNavDidChange=p(this,"ionNavDidChange",3),this.transInstr=[],this.gestureOrAnimationInProgress=!1,this.useRouter=!1,this.isTransitioning=!1,this.destroyed=!1,this.views=[],this.didLoad=!1,this.delegate=void 0,this.swipeGesture=void 0,this.animated=!0,this.animation=void 0,this.rootParams=void 0,this.root=void 0}swipeGestureChanged(){this.gesture&&this.gesture.enable(this.swipeGesture===!0)}rootChanged(){this.root!==void 0&&this.didLoad!==!1&&(this.useRouter||this.root!==void 0&&this.setRoot(this.root,this.rootParams))}componentWillLoad(){if(this.useRouter=document.querySelector("ion-router")!==null&&this.el.closest("[no-router]")===null,this.swipeGesture===void 0){const e=C(this);this.swipeGesture=y.getBoolean("swipeBackEnabled",e==="ios")}this.ionNavWillLoad.emit()}async componentDidLoad(){this.didLoad=!0,this.rootChanged(),this.gesture=(await import("./p-73a5875d.js")).createSwipeBackGesture(this.el,this.canStart.bind(this),this.onStart.bind(this),this.onMove.bind(this),this.onEnd.bind(this)),this.swipeGestureChanged()}connectedCallback(){this.destroyed=!1}disconnectedCallback(){for(const e of this.views)m(e.element,w),e._destroy();this.gesture&&(this.gesture.destroy(),this.gesture=void 0),this.transInstr.length=0,this.views.length=0,this.destroyed=!0}push(e,t,i,n){return this.insert(-1,e,t,i,n)}insert(e,t,i,n,s){return this.insertPages(e,[{component:t,componentProps:i}],n,s)}insertPages(e,t,i,n){return this.queueTrns({insertStart:e,insertViews:t,opts:i},n)}pop(e,t){return this.removeIndex(-1,1,e,t)}popTo(e,t,i){const n={removeStart:-1,removeCount:-1,opts:t};return typeof e=="object"&&e.component?(n.removeView=e,n.removeStart=1):typeof e=="number"&&(n.removeStart=e+1),this.queueTrns(n,i)}popToRoot(e,t){return this.removeIndex(1,-1,e,t)}removeIndex(e,t=1,i,n){return this.queueTrns({removeStart:e,removeCount:t,opts:i},n)}setRoot(e,t,i,n){return this.setPages([{component:e,componentProps:t}],i,n)}setPages(e,t,i){return t??(t={}),t.animated!==!0&&(t.animated=!1),this.queueTrns({insertStart:0,insertViews:e,removeStart:0,removeCount:-1,opts:t},i)}setRouteId(e,t,i,n){const s=this.getActiveSync();if(A(s,e,t))return Promise.resolve({changed:!1,element:s.element});let r;const o=new Promise(u=>r=u);let a;const d={updateURL:!1,viewIsReady:u=>{let h;const v=new Promise(l=>h=l);return r({changed:!0,element:u,markVisible:async()=>{h(),await a}}),v}};if(i==="root")a=this.setRoot(e,t,d);else{const u=this.views.find(h=>A(h,e,t));u?a=this.popTo(u,Object.assign(Object.assign({},d),{direction:"back",animationBuilder:n})):i==="forward"?a=this.push(e,t,Object.assign(Object.assign({},d),{animationBuilder:n})):i==="back"&&(a=this.setRoot(e,t,Object.assign(Object.assign({},d),{direction:"back",animated:!0,animationBuilder:n})))}return o}async getRouteId(){const e=this.getActiveSync();if(e)return{id:e.element.tagName,params:e.params,element:e.element}}async getActive(){return this.getActiveSync()}async getByIndex(e){return this.views[e]}async canGoBack(e){return this.canGoBackSync(e)}async getPrevious(e){return this.getPreviousSync(e)}getLength(){return this.views.length}getActiveSync(){return this.views[this.views.length-1]}canGoBackSync(e=this.getActiveSync()){return!!(e&&this.getPreviousSync(e))}getPreviousSync(e=this.getActiveSync()){if(!e)return;const t=this.views,i=t.indexOf(e);return i>0?t[i-1]:void 0}async queueTrns(e,t){var i,n;if(this.isTransitioning&&(!((i=e.opts)===null||i===void 0)&&i.skipIfBusy))return!1;const s=new Promise((r,o)=>{e.resolve=r,e.reject=o});if(e.done=t,e.opts&&e.opts.updateURL!==!1&&this.useRouter){const r=document.querySelector("ion-router");if(r){const o=await r.canTransition();if(o===!1)return!1;if(typeof o=="string")return r.push(o,e.opts.direction||"back"),!1}}return((n=e.insertViews)===null||n===void 0?void 0:n.length)===0&&(e.insertViews=void 0),this.transInstr.push(e),this.nextTrns(),s}success(e,t){if(this.destroyed){this.fireError("nav controller was destroyed",t);return}if(t.done&&t.done(e.hasCompleted,e.requiresTransition,e.enteringView,e.leavingView,e.direction),t.resolve(e.hasCompleted),t.opts.updateURL!==!1&&this.useRouter){const i=document.querySelector("ion-router");if(i){const n=e.direction==="back"?"back":"forward";i.navChanged(n)}}}failed(e,t){if(this.destroyed){this.fireError("nav controller was destroyed",t);return}this.transInstr.length=0,this.fireError(e,t)}fireError(e,t){t.done&&t.done(!1,!1,e),t.reject&&!this.destroyed?t.reject(e):t.resolve(!1)}nextTrns(){if(this.isTransitioning)return!1;const e=this.transInstr.shift();return e?(this.runTransition(e),!0):!1}async runTransition(e){try{this.ionNavWillChange.emit(),this.isTransitioning=!0,this.prepareTI(e);const t=this.getActiveSync(),i=this.getEnteringView(e,t);if(!t&&!i)throw new Error("no views in the stack to be removed");i&&i.state===V&&await i.init(this.el),this.postViewInit(i,t,e);const n=(e.enteringRequiresTransition||e.leavingRequiresTransition)&&i!==t;n&&e.opts&&t&&(e.opts.direction==="back"&&(e.opts.animationBuilder=e.opts.animationBuilder||i?.animationBuilder),t.animationBuilder=e.opts.animationBuilder);let s;n?s=await this.transition(i,t,e):s={hasCompleted:!0,requiresTransition:!1},this.success(s,e),this.ionNavDidChange.emit()}catch(t){this.failed(t,e)}this.isTransitioning=!1,this.nextTrns()}prepareTI(e){var t,i,n;const s=this.views.length;if((t=e.opts)!==null&&t!==void 0||(e.opts={}),(i=(n=e.opts).delegate)!==null&&i!==void 0||(n.delegate=this.delegate),e.removeView!==void 0){c(e.removeStart!==void 0,"removeView needs removeStart"),c(e.removeCount!==void 0,"removeView needs removeCount");const a=this.views.indexOf(e.removeView);if(a<0)throw new Error("removeView was not found");e.removeStart+=a}e.removeStart!==void 0&&(e.removeStart<0&&(e.removeStart=s-1),e.removeCount<0&&(e.removeCount=s-e.removeStart),e.leavingRequiresTransition=e.removeCount>0&&e.removeStart+e.removeCount===s),e.insertViews&&((e.insertStart<0||e.insertStart>s)&&(e.insertStart=s),e.enteringRequiresTransition=e.insertStart===s);const r=e.insertViews;if(!r)return;c(r.length>0,"length can not be zero");const o=L(r);if(o.length===0)throw new Error("invalid views to insert");for(const a of o){a.delegate=e.opts.delegate;const d=a.nav;if(d&&d!==this)throw new Error("inserted view was already inserted");if(a.state===g)throw new Error("inserted view was already destroyed")}e.insertViews=o}getEnteringView(e,t){const i=e.insertViews;if(i!==void 0)return i[i.length-1];const n=e.removeStart;if(n!==void 0){const s=this.views,r=n+e.removeCount;for(let o=s.length-1;o>=0;o--){const a=s[o];if((o<n||o>=r)&&a!==t)return a}}}postViewInit(e,t,i){var n,s,r;c(t||e,"Both leavingView and enteringView are null"),c(i.resolve,"resolve must be valid"),c(i.reject,"reject must be valid");const o=i.opts,{insertViews:a,removeStart:d,removeCount:u}=i;let h;if(d!==void 0&&u!==void 0){c(d>=0,"removeStart can not be negative"),c(u>=0,"removeCount can not be negative"),h=[];for(let l=d;l<d+u;l++){const f=this.views[l];f!==void 0&&f!==e&&f!==t&&h.push(f)}(n=o.direction)!==null&&n!==void 0||(o.direction="back")}const v=this.views.length+((s=a?.length)!==null&&s!==void 0?s:0)-(u??0);if(c(v>=0,"final balance can not be negative"),v===0)throw console.warn("You can't remove all the pages in the navigation stack. nav.pop() is probably called too many times.",this,this.el),new Error("navigation stack needs at least one root page");if(a){let l=i.insertStart;for(const f of a)this.insertViewAt(f,l),l++;i.enteringRequiresTransition&&((r=o.direction)!==null&&r!==void 0||(o.direction="forward"))}if(h&&h.length>0){for(const l of h)m(l.element,G),m(l.element,j),m(l.element,w);for(const l of h)this.destroyView(l)}}async transition(e,t,i){const n=i.opts,s=n.progressAnimation?h=>{h!==void 0&&!this.gestureOrAnimationInProgress?(this.gestureOrAnimationInProgress=!0,h.onFinish(()=>{this.gestureOrAnimationInProgress=!1},{oneTimeCallback:!0}),h.progressEnd(0,0,0)):this.sbAni=h}:void 0,r=C(this),o=e.element,a=t&&t.element,d=Object.assign(Object.assign({mode:r,showGoBack:this.canGoBackSync(e),baseEl:this.el,progressCallback:s,animated:this.animated&&y.getBoolean("animated",!0),enteringEl:o,leavingEl:a},n),{animationBuilder:n.animationBuilder||this.animation||y.get("navAnimation")}),{hasCompleted:u}=await R(d);return this.transitionFinish(u,e,t,n)}transitionFinish(e,t,i,n){const s=e?t:i;return s&&this.unmountInactiveViews(s),{hasCompleted:e,requiresTransition:!0,enteringView:t,leavingView:i,direction:n.direction}}insertViewAt(e,t){const i=this.views,n=i.indexOf(e);n>-1?(c(e.nav===this,"view is not part of the nav"),i.splice(n,1),i.splice(t,0,e)):(c(!e.nav,"nav is used"),e.nav=this,i.splice(t,0,e))}removeView(e){c(e.state===T||e.state===g,"view state should be loaded or destroyed");const t=this.views,i=t.indexOf(e);c(i>-1,"view must be part of the stack"),i>=0&&t.splice(i,1)}destroyView(e){e._destroy(),this.removeView(e)}unmountInactiveViews(e){if(this.destroyed)return;const t=this.views,i=t.indexOf(e);for(let n=t.length-1;n>=0;n--){const s=t[n],r=s.element;r&&(n>i?(m(r,w),this.destroyView(s)):n<i&&q(r,!0))}}canStart(){return!this.gestureOrAnimationInProgress&&!!this.swipeGesture&&!this.isTransitioning&&this.transInstr.length===0&&this.canGoBackSync()}onStart(){this.gestureOrAnimationInProgress=!0,this.pop({direction:"back",progressAnimation:!0})}onMove(e){this.sbAni&&this.sbAni.progressStep(e)}onEnd(e,t,i){if(this.sbAni){this.sbAni.onFinish(()=>{this.gestureOrAnimationInProgress=!1},{oneTimeCallback:!0});let n=e?-.001:.001;e?n+=S([0,0],[.32,.72],[0,1],[1,1],t)[0]:(this.sbAni.easing("cubic-bezier(1, 0, 0.68, 0.28)"),n+=S([0,0],[1,0],[.68,.28],[1,1],t)[0]),this.sbAni.progressEnd(e?1:0,n,i)}else this.gestureOrAnimationInProgress=!1}render(){return B("slot",null)}get el(){return E(this)}static get watchers(){return{swipeGesture:["swipeGestureChanged"],root:["rootChanged"]}}};I.style=N;export{I as ion_nav};

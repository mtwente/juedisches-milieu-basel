import{r as d,h as r,H as c,d as h}from"./p-1bafedb0.js";import{i as g}from"./p-27a92608.js";import{m as p,s as y,a as m}from"./p-6bc8d60f.js";const b=async()=>new Promise((t,i)=>{if(g())return t(null);if("Yasgui"in window)return t(window.Yasgui);const s=document.createElement("script");s.onload=()=>t(window.Yasgui),s.onerror=i,s.src="https://cdn.jsdelivr.net/npm/@triply/yasgui@4.2.28/build/yasgui.min.js",document.body.appendChild(s);const e=document.createElement("link");e.href="https://cdn.jsdelivr.net/npm/@triply/yasgui@4.2.28/build/yasgui.min.css",e.rel="stylesheet",e.type="text/css",document.body.appendChild(e)});function v(t){return class{constructor(s){this.priority=10,this.hideFromSelection=!1,this.label="Map Circles",this.expectedKeys=[{name:"radius",required:!1,customValidator:e=>{if(!(Number(e?.value)>0))return new Set(["must be parsable to a number, and bigger than 0"])}},{name:"number",required:!1,customValidator:e=>{if(isNaN(Number(e?.value)))return new Set(["must be parsable to a number"])}},{name:"long",required:!0,customValidator:e=>{const a=Number(e?.value);if(!(a>=-180&&a<=180))return new Set(["must be parsable to a number in the range -180 and +180"])}},{name:"lat",required:!0,customValidator:e=>{const a=Number(e?.value);if(!(a>=-90&&a<=90))return new Set(["must be parsable to a number in the range -90 and +90"])}}],this.yasr=s}draw(){const s=document.createElement("geov-yasgui-data-validation"),e=this.yasr.results.getBindings();s.data=e,s.expectedKeys=this.expectedKeys,this.yasr.resultsEl.appendChild(s),this.yasr.resultsEl.classList.add("ion-padding"),s.addEventListener("validationCompleted",a=>{var l;if(a.detail){const o=document.createElement("geov-yasgui-map-circles");o.data=e,o.style.height=(l=t?.mapHeight)!==null&&l!==void 0?l:"400px";for(const n in t)o[n]=t[n];this.yasr.resultsEl.classList.remove("ion-padding"),this.yasr.resultsEl.removeChild(s),this.yasr.resultsEl.appendChild(o)}})}canHandleResults(){return!this.yasr.results.hasError()}getIcon(){const s=document.createElement("ion-icon");return s.icon=p,s}}}const f="geov-yasgui{position:relative;display:block;width:100%;height:100%}geov-yasgui .toggle-button{position:absolute;z-index:1000;right:var(--ion-padding, 1rem);top:var(--ion-padding, 1rem)}geov-yasgui.toggling .tabsList,geov-yasgui.toggling .yasr_header,geov-yasgui.toggling .yasqe .resizeWrapper,geov-yasgui.toggling .yasqe .CodeMirror,geov-yasgui.toggling .controlbar{transition:all .2s ease-in;overflow:hidden}geov-yasgui .tabsList.collapsed,geov-yasgui .yasr_header.collapsed,geov-yasgui .yasqe.collapsed .resizeWrapper,geov-yasgui .controlbar.collapsed,geov-yasgui .yasqe.collapsed .CodeMirror{transition:all .2s ease-out;overflow:hidden}geov-yasgui .tabsList.collapsed,geov-yasgui .yasr_header.collapsed,geov-yasgui .yasqe.collapsed .resizeWrapper{height:0px}geov-yasgui .controlbar.collapsed{max-height:0px}geov-yasgui .yasqe.collapsed .CodeMirror{height:0px !important;border:none;min-height:0px}geov-yasgui .yasr.collapsed{margin-top:0px}",u=class{constructor(t){d(this,t),this.toggling=!1,this.plugins=new Set,this.collapse=!1,this.defaultPlugin="table",this.pluginOrder=["table","response"],this.pluginConfig={},this.queryTabs=[],this.hideYasqueToggle=!1}async componentWillLoad(){this.Y=await b()}componentDidLoad(){if(!g()){if(this.setupYasr(),localStorage.removeItem("yagui__config"),!this.el)return;const t=new this.Y(this.el,{});this.queryTabs.length&&t.getTab().close();const i=this.Y.Tab.getDefaults();this.queryTabs.forEach((s,e)=>{var a;t.addTab(e===0,Object.assign(Object.assign({},i),{id:"tab"+e,requestConfig:Object.assign(Object.assign({},i.requestConfig),{endpoint:s.sparqlEndpoint}),name:s.name,yasqe:{value:s.query},yasr:Object.assign(Object.assign({},i.yasr),{settings:{selectedPlugin:(a=s.selectedPlugin)!==null&&a!==void 0?a:this.defaultPlugin}})}),{avoidDuplicateTabs:!0})}),t.getTab().query(),this.setYasqueVisibility()}}toggleVisiblity(){this.toggling||(this.collapse=!this.collapse,this.setYasqueVisibility())}async setYasqueVisibility(){this.toggling=!0,this.el.classList.add("toggling"),this.el.querySelectorAll(".yasr, .yasr_header, .yasqe, .tabsList, .controlbar").forEach(i=>{this.collapse?i.classList.add("collapsed"):i.classList.remove("collapsed")}),await new Promise(i=>setTimeout(i,200)),this.el.classList.remove("toggling"),this.toggling=!1}setupYasr(){this.registerCustomPlugins(),this.setPluginOrder()}registerCustomPlugins(){var t;const i={mapCircles:v(this.pluginConfig.mapCircles)};(t=this.plugins)===null||t===void 0||t.forEach(s=>{i[s]&&this.Y.Yasr.registerPlugin(s,i[s])})}setPluginOrder(){this.Y.Yasr.defaults.pluginOrder=this.pluginOrder}render(){return r(c,null,!this.hideYasqueToggle&&r("ion-button",{class:"toggle-button",size:"small",onClick:()=>this.toggleVisiblity(),title:this.collapse?"Show query":"Hide query"},this.collapse?r("ion-icon",{slot:"icon-only",icon:y}):r("ion-icon",{slot:"icon-only",icon:m})))}get el(){return h(this)}};u.style=f;export{u as geov_yasgui};

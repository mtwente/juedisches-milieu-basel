import{r as e,h as t,H as i}from"./p-1bafedb0.js";import{a as n,i as o}from"./p-6bc8d60f.js";import{i as l}from"./p-66f7ee4f.js";import{i as s}from"./p-27a92608.js";const a=":host,\ngeov-yasgui-map-circles {\n  container-type: size;\n  display: block;\n  width: 100%;\n  height: 100%;\n}\n\n.geov-map-circles-container {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n\n.geov-map-circles-container .maplibregl-popup-content {\n  overflow-y: auto;\n  max-height: 210px;\n  padding: 0;\n}\n\n\ngeov-yasgui-map-circles ion-list {\n  overflow-y: auto;\n}\n\n.legend {\n  position: absolute;\n  z-index: 1;\n  max-width: 300px;\n  margin: 0;\n  top: 10px;\n  left: 10px;\n  max-height: calc(100% - 20px);\n  display: flex;\n  flex-direction: column;\n}\n\n\n.legend .collapse-button {\n  position: absolute;\n  margin: 0;\n  top: 4px;\n  left: 0;\n  z-index: 9999;\n}\n\n.legend.collapsed {\n  width: 46px;\n  height: 36px;\n\n}\n\n\n@container (width >=700px) {\n  .legend {\n    max-width: 300px;\n  }\n}\n\n#display-query {\n  position: absolute;\n  z-index: 1;\n  right: 0;\n}\n\n.yasgui .hidden {\n  display: none !important;\n}\n";function r(e,t){return{type:"FeatureCollection",features:e.map((e=>{var i,n,o,l,s,a,r;return{type:"Feature",geometry:{type:"Point",coordinates:[parseFloat(e["long"].value),parseFloat(e["lat"].value)]},properties:{label:(i=e["label"])===null||i===void 0?void 0:i.value,radius:Math.round((parseFloat((n=e["radius"])===null||n===void 0?void 0:n.value)||0)*10)/10,number:parseInt((o=e["number"])===null||o===void 0?void 0:o.value),type:((l=e["type"])===null||l===void 0?void 0:l.value)||"none",typeindex:t.indexOf(((s=e["type"])===null||s===void 0?void 0:s.value)||"none"),link:(a=e["link"])===null||a===void 0?void 0:a.value,children:(r=e["children"])===null||r===void 0?void 0:r.value}}}))}}const c=class{constructor(t){e(this,t);this.data=[{radius:{value:"80.2345",type:"literal"},number:{value:"0",type:"literal"},type:{value:"default",type:"literal"},long:{value:"8.2318",type:"literal"},lat:{value:"46.7985",type:"literal"},label:{value:"default",type:"literal"},link:{value:"default",type:"literal"}}];this.radiusMin=8;this.radiusMax=20;this.maxZoom=10;this.colorScale=["#a6cee3","#1f78b4","#b2df8a","#33a02c"];this.ledgendExpanded=true;this.disableScrollZoom=false;this.displayMapNavigationControls=false;this.labelIndices=[...new Set(this.data.map((e=>{var t;return((t=e["type"])===null||t===void 0?void 0:t.value)||"none"})))]}async componentDidLoad(){if(!s()){const e=this.data.filter((e=>{var t,i,n,o,l,s,a,r,c;if(Object.hasOwn(e,"radius")&&(isNaN((t=e["radius"])===null||t===void 0?void 0:t.value)||Number((i=e["radius"])===null||i===void 0?void 0:i.value)===0))return true;if(Object.hasOwn(e,"number")&&isNaN((n=e["number"])===null||n===void 0?void 0:n.value))return true;return Number((o=e["long"])===null||o===void 0?void 0:o.value)<-180||Number((l=e["long"])===null||l===void 0?void 0:l.value)>180||Number((s=e["lat"])===null||s===void 0?void 0:s.value)<-90||Number((a=e["lat"])===null||a===void 0?void 0:a.value)>90||isNaN((r=e["long"])===null||r===void 0?void 0:r.value)||isNaN((c=e["lat"])===null||c===void 0?void 0:c.value)}));if(!(e===null||e===void 0?void 0:e.length)){const e=await l();const t=new e.Map({container:this.mapContainerEl,style:{version:8,sources:{osm:{type:"raster",tiles:["https://a.basemaps.cartocdn.com/rastertiles/light_nolabels/{z}/{x}/{y}{ratio}.png","https://b.basemaps.cartocdn.com/rastertiles/light_nolabels/{z}/{x}/{y}{ratio}.png","https://c.basemaps.cartocdn.com/rastertiles/light_nolabels/{z}/{x}/{y}{ratio}.png"],tileSize:256,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',maxzoom:19}},layers:[{id:"osm",type:"raster",source:"osm"}],glyphs:"https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf"},zoom:6});let i=Number.MAX_VALUE;let n=Number.MIN_VALUE;let o=Number.MAX_VALUE;let s=Number.MIN_VALUE;this.data.forEach((e=>{const t=parseFloat(e["long"].value);const l=parseFloat(e["lat"].value);i=Math.min(i,t);n=Math.max(n,t);o=Math.min(o,l);s=Math.max(s,l)}));const a=[[i,o],[n,s]];t.fitBounds(a,{padding:50,maxZoom:this.maxZoom,animate:false});if(this.disableScrollZoom){t.scrollZoom.disable()}if(this.displayMapNavigationControls){t.addControl(new e.NavigationControl)}t.on("load",(()=>{t.addSource("places",{type:"geojson",data:r(this.data,this.labelIndices)});const i=Math.max(...this.data.map((e=>{var t;return parseInt((t=e["radius"])===null||t===void 0?void 0:t.value)||0})));let n;if(this.colorScale.length<2){n=this.colorScale[0]}else{n=["step",["get","typeindex"]];for(let e=0;e<this.colorScale.length;e++){if(e>0)n.push(e);n.push(this.colorScale[e])}}t.addLayer({id:"circles",type:"circle",source:"places",paint:{"circle-color":n,"circle-radius":i?["interpolate",["linear"],["get","radius"],0,this.radiusMin,i,this.radiusMax]:this.radiusMin,"circle-opacity":.8}});const o=i=>{const n=i.features[0].geometry.coordinates;const o=i.features.map((e=>{let t=[];try{t=JSON.parse(e.properties.children)}catch(e){}const i={label:e.properties.label,url:e.properties.link,suffix:e.properties.number,items:t.map((e=>({label:e===null||e===void 0?void 0:e.label,url:e===null||e===void 0?void 0:e.url})))};return i}));const l=document.createElement("geov-map-circles-popup");l.items=o;(new e.Popup).setLngLat(n).setDOMContent(l).setMaxWidth("340px").addTo(t)};t.on("click","circles",o);t.on("mouseenter","circles",(()=>{t.getCanvas().style.cursor="pointer"}));t.on("mouseleave","circles",(()=>{t.getCanvas().style.cursor=""}))}))}}}render(){return t(i,null,t("ion-card",{class:`legend ${this.ledgendExpanded?"":"collapsed"}`},t("ion-card-header",null,t("ion-button",{size:"small",class:"collapse-button",fill:"clear",onClick:()=>this.ledgendExpanded=!this.ledgendExpanded},t("ion-icon",{icon:this.ledgendExpanded?n:o,slot:"icon-only"}))),t("ion-list",null,this.labelIndices.map(((e,i)=>t("ion-item",{lines:i===this.labelIndices.length-1?"none":"full"},t("svg",{slot:"start",height:"1rem",width:"1rem"},t("circle",{cx:"50%",cy:"50%",r:"50%",fill:this.colorScale[i%this.colorScale.length]})),t("ion-label",{class:"ion-text-wrap"},e)))))),t("div",{class:"geov-map-circles-container",ref:e=>this.mapContainerEl=e}))}};c.style=a;export{c as geov_yasgui_map_circles};
//# sourceMappingURL=p-9579a5a0.entry.js.map
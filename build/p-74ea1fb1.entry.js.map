{"version":3,"names":["geovIfCss","GeovIf","constructor","hostRef","this","_ssrId","undefined","sparqlEndpoint","sparqlQuery","data","loading","showChildren","setSSRId","componentWillLoad","getSSRData","fetchData","then","d","setSSRData","catch","q","replace","sparqlJson","res","_a","_b","_c","_d","results","bindings","condition","value","Object","assign","_","error","render","display","h","Host","style"],"sources":["node_modules/@geovistory/design-system-web/dist/collection/components/geov-if/geov-if.css?tag=geov-if","node_modules/@geovistory/design-system-web/dist/collection/components/geov-if/geov-if.js"],"sourcesContent":[":host {\n  display: block;\n}\n","import { h, Host } from \"@stencil/core\";\nimport { sparqlJson } from \"../../lib/sparqlJson\";\nimport { getSSRData } from \"../../lib/ssr/getSSRData\";\nimport { setSSRData } from \"../../lib/ssr/setSSRData\";\nimport { setSSRId } from \"../../lib/ssr/setSSRId\";\n/**\n * Small helper component to wrap a piece of html\n * into a container that does a sparql request and displays\n * its children, if the request returns `true` on the\n * `?condition` binding of the first returned record.\n */\nexport class GeovIf {\n  constructor() {\n    this._ssrId = undefined;\n    this.sparqlEndpoint = undefined;\n    this.sparqlQuery = undefined;\n    this.data = { loading: true, showChildren: false };\n    setSSRId(this);\n  }\n  async componentWillLoad() {\n    // try to get data from ssr\n    this.data = getSSRData(this._ssrId);\n    // if no data found, fetchData\n    if (!this.data) {\n      // set data to loading (in immutable way)\n      this.data = { loading: true, showChildren: false };\n      await this.fetchData()\n        .then(d => {\n        this.data = d;\n        setSSRData(this._ssrId, d);\n        return d;\n      })\n        .catch(d => {\n        this.data = d;\n        return d;\n      });\n    }\n  }\n  /**\n   * Do the sparql request(s)\n   * @returns a Promise with the data for this component\n   */\n  async fetchData() {\n    const q = this.sparqlQuery\n      .replace(/&amp;/g, '&')\n      .replace(/&lt;/g, '<')\n      .replace(/&gt;/g, '>')\n      .replace(/&quot;/g, '\"')\n      .replace(/&apos;/g, \"'\");\n    return sparqlJson(this.sparqlEndpoint, q)\n      .then(res => {\n      var _a, _b, _c, _d;\n      const showChildren = ((_d = (_c = (_b = (_a = res === null || res === void 0 ? void 0 : res.results) === null || _a === void 0 ? void 0 : _a.bindings) === null || _b === void 0 ? void 0 : _b[0]) === null || _c === void 0 ? void 0 : _c.condition) === null || _d === void 0 ? void 0 : _d.value) === 'true' ? true : false;\n      return Object.assign(Object.assign({}, this.data), { showChildren, loading: false });\n    })\n      .catch(_ => {\n      return Object.assign(Object.assign({}, this.data), { error: true, loading: false });\n    });\n  }\n  render() {\n    const display = this.data.showChildren ? 'initital' : 'none';\n    return (h(Host, null, h(\"div\", { style: { display: display } }, h(\"slot\", null))));\n  }\n  static get is() { return \"geov-if\"; }\n  static get originalStyleUrls() {\n    return {\n      \"$\": [\"geov-if.css\"]\n    };\n  }\n  static get styleUrls() {\n    return {\n      \"$\": [\"geov-if.css\"]\n    };\n  }\n  static get properties() {\n    return {\n      \"_ssrId\": {\n        \"type\": \"string\",\n        \"mutable\": false,\n        \"complexType\": {\n          \"original\": \"string\",\n          \"resolved\": \"string\",\n          \"references\": {}\n        },\n        \"required\": false,\n        \"optional\": true,\n        \"docs\": {\n          \"tags\": [],\n          \"text\": \"\"\n        },\n        \"attribute\": \"_ssr-id\",\n        \"reflect\": true\n      },\n      \"sparqlEndpoint\": {\n        \"type\": \"string\",\n        \"mutable\": false,\n        \"complexType\": {\n          \"original\": \"string\",\n          \"resolved\": \"string\",\n          \"references\": {}\n        },\n        \"required\": false,\n        \"optional\": false,\n        \"docs\": {\n          \"tags\": [],\n          \"text\": \"sparqlEndpoint\\nURL of the sparql endpoint\"\n        },\n        \"attribute\": \"sparql-endpoint\",\n        \"reflect\": false\n      },\n      \"sparqlQuery\": {\n        \"type\": \"string\",\n        \"mutable\": false,\n        \"complexType\": {\n          \"original\": \"string\",\n          \"resolved\": \"string\",\n          \"references\": {}\n        },\n        \"required\": false,\n        \"optional\": false,\n        \"docs\": {\n          \"tags\": [],\n          \"text\": \"A sparql query with binding ?condition of type ^^xsd:bolean.\\nIf the first ?condition of response is true,\\nthe children of the element are rendered, otherwise not.\\n\\nExample:\\n```sparql\\n# check if geov:i836507 is annotated entity (ontome:p1875)\\n# of an annotation in text (ontome:p1875)\\nPREFIX ontome: <https://ontome.net/ontology/>\\nPREFIX geov: <http://geovistory.org/resource/>\\n\\nSELECT  ((count(?subject ) > 0)as ?condition)\\nWHERE {\\n  ?subject ontome:p1875 geov:i836507 .\\n  ?subject a ontome:c933\\n}\\nGROUP BY ?subject\\nLIMIT 1\\n```\"\n        },\n        \"attribute\": \"sparql-query\",\n        \"reflect\": false\n      }\n    };\n  }\n  static get states() {\n    return {\n      \"data\": {}\n    };\n  }\n}\n//# sourceMappingURL=geov-if.js.map\n"],"mappings":"wIAAA,MAAMA,EAAY,uB,MCWLC,EAAM,MACjB,WAAAC,CAAAC,G,UACEC,KAAKC,OAASC,UACdF,KAAKG,eAAiBD,UACtBF,KAAKI,YAAcF,UACnBF,KAAKK,KAAO,CAAEC,QAAS,KAAMC,aAAc,OAC3CC,EAASR,K,CAEX,uBAAMS,GAEJT,KAAKK,KAAOK,EAAWV,KAAKC,QAE5B,IAAKD,KAAKK,KAAM,CAEdL,KAAKK,KAAO,CAAEC,QAAS,KAAMC,aAAc,aACrCP,KAAKW,YACRC,MAAKC,IACNb,KAAKK,KAAOQ,EACZC,EAAWd,KAAKC,OAAQY,GACxB,OAAOA,CAAC,IAEPE,OAAMF,IACPb,KAAKK,KAAOQ,EACZ,OAAOA,CAAC,G,EAQd,eAAMF,GACJ,MAAMK,EAAIhB,KAAKI,YACZa,QAAQ,SAAU,KAClBA,QAAQ,QAAS,KACjBA,QAAQ,QAAS,KACjBA,QAAQ,UAAW,KACnBA,QAAQ,UAAW,KACtB,OAAOC,EAAWlB,KAAKG,eAAgBa,GACpCJ,MAAKO,IACN,IAAIC,EAAIC,EAAIC,EAAIC,EAChB,MAAMhB,IAAiBgB,GAAMD,GAAMD,GAAMD,EAAKD,IAAQ,MAAQA,SAAa,OAAS,EAAIA,EAAIK,WAAa,MAAQJ,SAAY,OAAS,EAAIA,EAAGK,YAAc,MAAQJ,SAAY,OAAS,EAAIA,EAAG,MAAQ,MAAQC,SAAY,OAAS,EAAIA,EAAGI,aAAe,MAAQH,SAAY,OAAS,EAAIA,EAAGI,SAAW,OAAS,KAAO,MACzT,OAAOC,OAAOC,OAAOD,OAAOC,OAAO,GAAI7B,KAAKK,MAAO,CAAEE,eAAcD,QAAS,OAAQ,IAEnFS,OAAMe,GACAF,OAAOC,OAAOD,OAAOC,OAAO,GAAI7B,KAAKK,MAAO,CAAE0B,MAAO,KAAMzB,QAAS,S,CAG/E,MAAA0B,GACE,MAAMC,EAAUjC,KAAKK,KAAKE,aAAe,WAAa,OACtD,OAAQ2B,EAAEC,EAAM,KAAMD,EAAE,MAAO,CAAEE,MAAO,CAAEH,QAASA,IAAaC,EAAE,OAAQ,O"}